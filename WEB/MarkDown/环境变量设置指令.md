# 🎯 环境变量设置

所有环境（开发/生产）统一依赖下列变量，修改即可迁移到任意主机或端口。

## 🌐 必填变量（通用）

| 变量 | 说明 |
| --- | --- |
| `ZYRO_ENV` | 运行模式，`dev` 或 `prod`，前后端共用 |
| `ZYRO_BACKEND_PORT` | 后端监听端口，同时供前端自动探测使用 |
| `ZYRO_API_ORIGIN` | 前端调用入口：`auto` 表示自动根据当前域名+`ZYRO_BACKEND_PORT` 拼接；否则填写完整协议+域名（例如 `https://frp.example.com`），系统会自动追加 `/backend/` |
| `JWT_SECRET` | 后端 JWT 签名密钥，至少 32 字节 |

## 📦 常用可选变量

| 变量 | 说明 |
| --- | --- |
| `DATABASE_URL` | JDBC 连接串（如 `jdbc:mysql://host:3306/ZyroFrp`） |
| `DATABASE_USERNAME` / `DATABASE_PASSWORD` | 数据库账号与密码 |
| `MAIL_HOST` / `MAIL_PORT` | 邮件服务器地址与端口（如 `smtp.163.com` / `465`） |
| `MAIL_USERNAME` / `MAIL_PASSWORD` | 邮件账户与授权码 |
| `MAIL_DEFAULT_ENCODING` | 可选，缺省为 `UTF-8` |
| `ZYRO_DEPLOY_ENV` | 仅部署脚本使用；设置后可在本次部署期间临时覆盖 `ZYRO_ENV`（例如强制产物输出为 `prod`） |
| `ZYRO_DEPLOY_API_ORIGIN` | 仅部署脚本使用；若保持 `ZYRO_API_ORIGIN=auto`，可指定部署期间临时生效的生产域名（脚本会自动覆盖后再恢复） |
| 其它 `SPRING_*`、`MAIL_*` | 如果需要覆盖 Spring Boot 的默认配置，可在此延伸 |

## 💻 macOS（开发环境示例）

```bash
nano ~/.zshrc

export ZYRO_ENV=dev
export ZYRO_BACKEND_PORT=8085
export ZYRO_API_ORIGIN=auto
export JWT_SECRET=dev-secret-请替换
export ZYRO_DEPLOY_API_ORIGIN=https://your-domain.com
export ZYRO_DEPLOY_ENV=prod
export DATABASE_PASSWORD=本地数据库密码
export MAIL_PASSWORD=RGbiENkGuAA57Vm3

source ~/.zshrc
```

开发过程中若想强制访问内网或远程后端，可改为：

```bash
export ZYRO_API_ORIGIN=http://192.168.0.10
```

## 🖥️ Linux（生产环境示例）

```bash
sudo nano /etc/environment

ZYRO_ENV=prod
ZYRO_BACKEND_PORT=8085
ZYRO_API_ORIGIN=https://your-domain.com
JWT_SECRET=prod-secret-请替换
DATABASE_URL=jdbc:mysql://your-db:3306/ZyroFrp
DATABASE_USERNAME=ZyroFrp
DATABASE_PASSWORD=服务器数据库密码
MAIL_HOST=smtp.163.com
MAIL_USERNAME=jsk476@163.com
MAIL_PASSWORD=RGbiENkGuAA57Vm3
MAIL_PORT=465
```

## 📝 注意事项

- 修改环境变量后需重新加载 shell（`source ~/.zshrc` 或重新登录服务器）。
- `ZYRO_API_ORIGIN` **必须**设置：开发时用 `auto`，生产时填写真实域名（无需 `/backend/`，程序会统一追加）。
- 若本机保持 `ZYRO_API_ORIGIN=auto` 但需要运行部署脚本，请额外设置 `ZYRO_DEPLOY_API_ORIGIN`（脚本在运行期间自动使用该域名，结束后无需还原）。
- 如需在部署期间临时将 `ZYRO_ENV` 切换为 `prod`，可设置 `ZYRO_DEPLOY_ENV=prod` 运行脚本，执行完成后会自动恢复到原 Shell 环境。
- `ZYRO_BACKEND_PORT` 变更后无需调整代码，前端自动复用该端口访问后端。
- `ZYRO_ENV` 决定 Spring Profile 与前端指示器显示；确保 dev/ prod 与部署环境一致。
